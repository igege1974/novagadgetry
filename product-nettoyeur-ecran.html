<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nettoyeur d'Écran - NovaGadgetry</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://www.paypal.com/sdk/js?client-id=AWZGrfFz9C5WpJPL7UXTPt-0GarcFddR7Icp5tTdQAvsnmn1KLxsdqEbpKjAuTVARn_a7iYKs1MUlf7i&currency=CAD"></script>
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body class="bg-gray-50 font-sans">
  <nav class="bg-white shadow-sm p-4">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
      <a href="index.html" class="text-2xl font-bold text-blue-600">NovaGadgetry</a>
      <a href="catalogue.html" class="text-gray-600">Retour au catalogue</a>
    </div>
  </nav>

  <main class="max-w-6xl mx-auto p-6 mt-8">
    <div class="flex flex-col md:flex-row gap-12">
      <!-- Galerie -->
      <div class="md:w-1/2">
        <div class="relative">
          <div class="bg-white rounded-2xl shadow-lg p-3">
            <img id="mainImage" src="https://m.media-amazon.com/images/I/71SCNAipTtL._AC_UF894,1000_QL80_.jpg" alt="Nettoyeur d'Écran" class="w-full h-96 rounded-xl object-contain bg-white" />
          </div>

          <div class="flex flex-wrap mt-4 gap-3 justify-center">
            <img src="https://m.media-amazon.com/images/I/71SCNAipTtL._AC_UF894,1000_QL80_.jpg" alt="Nettoyeur d'Écran - vue 1" class="w-20 h-20 rounded-lg cursor-pointer border-2 border-blue-600 object-contain bg-white" onclick="document.getElementById('mainImage').src=this.src" />
            <img src="https://m.media-amazon.com/images/I/71DplVF8lAL._AC_UF894,1000_QL80_.jpg" alt="Nettoyeur d'Écran - vue 2" class="w-20 h-20 rounded-lg cursor-pointer border-2 border-transparent hover:border-blue-600 object-contain bg-white" onclick="document.getElementById('mainImage').src=this.src" />
            <img src="https://m.media-amazon.com/images/I/715HyMJf2VL._AC_UF894,1000_QL80_.jpg" alt="Nettoyeur d'Écran - vue 3" class="w-20 h-20 rounded-lg cursor-pointer border-2 border-transparent hover:border-blue-600 object-contain bg-white" onclick="document.getElementById('mainImage').src=this.src" />
          </div>

          <p class="text-xs text-gray-500 mt-3 text-center">Astuce : cliquez sur une miniature pour changer la photo.</p>
        </div>
      </div>

      <!-- Détails produit + paiements -->
      <div class="md:w-1/2">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-4">Nettoyeur d'Écran</h1>
        <p class="text-gray-600 mb-6">Solution de nettoyage professionnelle pour smartphones, tablettes, ordinateurs et lunettes. Sans traces, sans rayures.</p>

        <div class="flex items-end gap-3 mb-4">
          <div class="text-3xl font-bold text-blue-600"><span id="unit-price">18.99</span>$ CAD</div>
          <div class="text-sm text-gray-500">Livraison suivie</div>
        </div>

        <!-- Stock indicator - LOW STOCK -->
        <div class="mb-4">
          <span id="stock-indicator" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-700">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
            ⚠️ Plus que 3 articles en stock - Commandez vite !
          </span>
        </div>

        <!-- Quantity selector -->
        <div class="flex items-center gap-4 mb-6 bg-gray-100 rounded-xl p-4">
          <label for="quantity" class="font-semibold text-gray-700">Quantité :</label>
          <select id="quantity" class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
          </select>
          <div class="text-lg font-bold text-gray-900">
            Total : <span id="total-price" class="text-blue-600">18.99</span>$ CAD
          </div>
        </div>

        <ul class="space-y-2 text-gray-700 mb-8">
          <li>• Formule sans alcool, sans ammoniaque</li>
          <li>• Compatible tous écrans (téléphone, tablette, laptop)</li>
          <li>• Microfibre incluse pour un nettoyage parfait</li>
          <li>• Format compact, facile à transporter</li>
          <li>• Élimine traces de doigts et poussière</li>
        </ul>

        <div class="bg-white rounded-2xl shadow p-5 mb-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-3">Payer avec PayPal / Carte</h2>
          <div id="paypal-button-container"></div>
          <p class="text-xs text-gray-500 mt-3">PayPal accepte aussi les cartes (Visa, Mastercard, Amex) selon pays.</p>
        </div>

        <div class="bg-white rounded-2xl shadow p-5">
          <h2 class="text-lg font-semibold text-gray-900 mb-3">Payer par carte (Stripe)</h2>
          <div id="card-element" class="p-4 border rounded-lg bg-white mb-4"></div>
          <button id="stripe-button" class="w-full bg-black text-white py-4 rounded-xl font-bold">Payer <span id="stripe-total">18.99</span>$ avec Stripe</button>
          <p class="text-xs text-gray-500 mt-3">Note : sur un site 100% statique, Stripe nécessite un backend pour finaliser un paiement.</p>
        </div>

        <div class="mt-6 grid grid-cols-3 gap-3 text-center text-xs text-gray-600">
          <div class="bg-gray-100 rounded-lg py-2">Paiement sécurisé</div>
          <div class="bg-gray-100 rounded-lg py-2">Support 7j/7</div>
          <div class="bg-gray-100 rounded-lg py-2">Satisfait ou remboursé</div>
        </div>
      </div>
    </div>
  </main>

  <script>
    const UNIT_PRICE = 18.99;
    const PRODUCT_NAME = "Nettoyeur d'Écran";
    const STOCK = 3;

    // Update quantity options based on stock
    function updateQuantityOptions() {
      const select = document.getElementById('quantity');
      const maxQty = Math.min(10, STOCK);
      select.innerHTML = '';
      for (let i = 1; i <= maxQty; i++) {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = i;
        select.appendChild(opt);
      }
    }
    updateQuantityOptions();

    function getQuantity() {
      return parseInt(document.getElementById('quantity').value) || 1;
    }

    function getTotalPrice() {
      return (UNIT_PRICE * getQuantity()).toFixed(2);
    }

    function updatePriceDisplay() {
      const total = getTotalPrice();
      document.getElementById('total-price').textContent = total;
      document.getElementById('stripe-total').textContent = total;
    }

    document.getElementById('quantity').addEventListener('change', updatePriceDisplay);

    // PayPal
    paypal.Buttons({
      createOrder: function(data, actions) {
        const qty = getQuantity();
        const total = getTotalPrice();
        return actions.order.create({
          purchase_units: [{ 
            amount: { value: total },
            description: PRODUCT_NAME + ' (x' + qty + ') - NovaGadgetry'
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          alert('Paiement réussi ! Merci ' + details.payer.name.given_name + '. Vous recevrez un email de confirmation.');
        });
      },
      onError: function(err) {
        alert('Une erreur est survenue lors du paiement. Veuillez réessayer.');
        console.error(err);
      }
    }).render('#paypal-button-container');

    // Stripe
    const stripe = Stripe('pk_live_51SwpyUBIzzzQv9G1fiKGFD0KKUeLRXh9bgmj0PxfqSRcpQk0ElFfjBZBlOzskYyy2a00guCUCF4J');
    const elements = stripe.elements();
    const card = elements.create('card', { hidePostalCode: true });
    card.mount('#card-element');

    document.getElementById('stripe-button').addEventListener('click', async function() {
      const btn = this;
      const qty = getQuantity();
      const total = getTotalPrice();
      btn.disabled = true;
      btn.textContent = 'Traitement...';

      try {
        const result = await stripe.createPaymentMethod({ type: 'card', card: card });
        if (result.error) {
          alert(result.error.message);
        } else {
          alert('Carte capturée (PaymentMethod créé): ' + result.paymentMethod.id + '\nProduit: ' + PRODUCT_NAME + ' x' + qty + '\nTotal: ' + total + '$ CAD\n\nPour encaisser réellement, il faut un backend Stripe (PaymentIntent).');
        }
      } finally {
        btn.disabled = false;
        btn.textContent = 'Payer ' + total + '$ avec Stripe';
      }
    });
  </script>
</body>
</html>
