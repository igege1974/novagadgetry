<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NovaGadgetry - Gadgets & accessoires pratiques</title>
  <meta name="description" content="NovaGadgetry : accessoires t√©l√©phone et gadgets pratiques. Paiement s√©curis√© PayPal & carte. Livraison suivie au Canada." />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .mini-cart-dropdown { display: none; }
    .mini-cart-dropdown.active { display: block; }
    .cart-badge { display: none; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-extrabold text-blue-600">NovaGadgetry</a>
      <nav class="flex items-center gap-6 text-sm font-semibold">
        <a href="products.html" class="text-gray-700 hover:text-blue-600">Produits</a>
        <a href="catalogue.html" class="text-gray-700 hover:text-blue-600">Catalogue</a>
        <a href="policies.html" class="text-gray-700 hover:text-blue-600">Politiques</a>
        <a href="#contact" class="text-gray-700 hover:text-blue-600">Contact</a>
        <!-- Ic√¥ne Panier -->
        <div class="relative">
          <button id="cart-toggle" class="relative p-2 text-gray-700 hover:text-blue-600 transition">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
            </svg>
            <span class="cart-badge absolute -top-1 -right-1 bg-blue-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">0</span>
          </button>
          <!-- Mini-panier dropdown -->
          <div id="mini-cart" class="mini-cart-dropdown absolute right-0 mt-2 w-80 bg-white rounded-2xl shadow-2xl border border-gray-100 z-50">
            <div class="p-4 border-b border-gray-100">
              <h3 class="font-bold text-gray-900">Mon Panier</h3>
            </div>
            <div id="mini-cart-content">
              <!-- Contenu charg√© dynamiquement -->
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <section class="max-w-6xl mx-auto px-6 pt-10 pb-8">
    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-3xl text-white p-8 md:p-12 shadow-lg">
      <div class="max-w-2xl">
        <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">Gadgets utiles, prix clairs, livraison suivie</h1>
        <p class="mt-4 text-white/90 text-lg">S√©lection d'accessoires t√©l√©phone et gadgets pratiques pour le quotidien au Canada. Paiement s√©curis√© PayPal & carte.</p>
        <div class="mt-6 flex flex-col sm:flex-row gap-3">
          <a href="catalogue.html" class="inline-flex justify-center items-center bg-white text-blue-700 px-6 py-3 rounded-xl font-extrabold">Voir le catalogue</a>
          <a href="#contact" class="inline-flex justify-center items-center bg-black/20 border border-white/30 px-6 py-3 rounded-xl font-bold">Nous contacter</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Section Top Ventes - 6 produits best-sellers depuis Shopify -->
  <section class="max-w-6xl mx-auto px-6 pb-12">
    <div class="flex items-end justify-between gap-4 mb-6">
      <div>
        <h2 class="text-2xl font-extrabold text-gray-900">üî• Top Ventes</h2>
        <p class="text-gray-500 mt-1">Nos produits les plus populaires</p>
      </div>
      <a href="catalogue.html" class="text-sm font-bold text-blue-600 hover:underline">Tout voir ‚Üí</a>
    </div>

    <div id="top-ventes-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Skeleton loader -->
      <div class="animate-pulse bg-white rounded-2xl shadow p-4">
        <div class="bg-gray-200 h-48 rounded-xl mb-4"></div>
        <div class="bg-gray-200 h-4 rounded w-3/4 mb-2"></div>
        <div class="bg-gray-200 h-4 rounded w-1/2"></div>
      </div>
      <div class="animate-pulse bg-white rounded-2xl shadow p-4">
        <div class="bg-gray-200 h-48 rounded-xl mb-4"></div>
        <div class="bg-gray-200 h-4 rounded w-3/4 mb-2"></div>
        <div class="bg-gray-200 h-4 rounded w-1/2"></div>
      </div>
      <div class="animate-pulse bg-white rounded-2xl shadow p-4 hidden sm:block">
        <div class="bg-gray-200 h-48 rounded-xl mb-4"></div>
        <div class="bg-gray-200 h-4 rounded w-3/4 mb-2"></div>
        <div class="bg-gray-200 h-4 rounded w-1/2"></div>
      </div>
    </div>

    <div class="mt-10 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
      <div class="bg-white rounded-2xl shadow p-5"><div class="font-extrabold">Paiement s√©curis√©</div><div class="text-gray-600 mt-1">PayPal + carte bancaire (selon pays).</div></div>
      <div class="bg-white rounded-2xl shadow p-5"><div class="font-extrabold">Livraison suivie</div><div class="text-gray-600 mt-1">Num√©ro de suivi communiqu√© apr√®s exp√©dition.</div></div>
      <div class="bg-white rounded-2xl shadow p-5"><div class="font-extrabold">Support client</div><div class="text-gray-600 mt-1">√âcrivez-nous : contact@novagadgetry.com</div></div>
    </div>
  </section>

  <!-- Section Contact avec Formspree -->
  <section id="contact" class="max-w-6xl mx-auto px-6 py-12">
    <div class="bg-white rounded-3xl shadow-lg p-8 md:p-12">
      <h2 class="text-3xl font-extrabold text-gray-900 mb-2">Nous contacter</h2>
      <p class="text-gray-600 mb-8">Une question sur un produit ou votre commande ? Remplissez le formulaire ci-dessous.</p>
      
      <form action="https://formspree.io/f/xvgobgqr" method="POST" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">Nom complet</label>
            <input type="text" id="name" name="name" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Votre nom">
          </div>
          <div>
            <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">Email</label>
            <input type="email" id="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="votre@email.com">
          </div>
        </div>
        <div>
          <label for="subject" class="block text-sm font-semibold text-gray-700 mb-2">Sujet</label>
          <select id="subject" name="subject" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="question">Question sur un produit</option>
            <option value="commande">Suivi de commande</option>
            <option value="retour">Retour / Remboursement</option>
            <option value="autre">Autre</option>
          </select>
        </div>
        <div>
          <label for="message" class="block text-sm font-semibold text-gray-700 mb-2">Message</label>
          <textarea id="message" name="message" rows="5" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="D√©crivez votre demande..."></textarea>
        </div>
        <button type="submit" class="w-full md:w-auto bg-blue-600 text-white px-8 py-4 rounded-xl font-bold hover:bg-blue-700 transition">Envoyer le message</button>
      </form>
    </div>
  </section>

  <footer class="bg-white">
    <div class="max-w-6xl mx-auto px-6 py-10">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <div class="font-extrabold text-blue-600">NovaGadgetry</div>
          <div class="text-sm text-gray-600">Contact : <a class="text-blue-600 hover:underline" href="mailto:contact@novagadgetry.com">contact@novagadgetry.com</a></div>
        </div>
        <div class="flex gap-6 text-sm font-semibold">
          <a href="catalogue.html" class="text-gray-700 hover:text-blue-600">Catalogue</a>
          <a href="policies.html" class="text-gray-700 hover:text-blue-600">Politiques</a>
        </div>
      </div>
      <div class="text-xs text-gray-500 mt-6">¬© NovaGadgetry ‚Äî novagadgetry.com</div>
    </div>
  </footer>

  <script src="shopify-storefront.js"></script>
  <script>
    // Configuration
    const SHOPIFY_DOMAIN = 'novagadgetry-3.myshopify.com';
    const STOREFRONT_TOKEN = '17b5e9148ecf9d56db3abd9b8310cb86';

    // Toggle mini-cart
    document.getElementById('cart-toggle').addEventListener('click', function(e) {
      e.stopPropagation();
      const miniCart = document.getElementById('mini-cart');
      miniCart.classList.toggle('active');
      renderMiniCart();
    });

    // Fermer le mini-cart en cliquant ailleurs
    document.addEventListener('click', function(e) {
      const miniCart = document.getElementById('mini-cart');
      const cartToggle = document.getElementById('cart-toggle');
      if (!miniCart.contains(e.target) && !cartToggle.contains(e.target)) {
        miniCart.classList.remove('active');
      }
    });

    // Charger les Top Ventes depuis Shopify
    async function loadTopVentes() {
      const grid = document.getElementById('top-ventes-grid');
      
      try {
        // R√©cup√©rer les produits best-seller
        const products = await ShopifyStorefront.getBestSellers(6);
        
        if (products.length === 0) {
          // Si pas de best-sellers, r√©cup√©rer tous les produits
          const allProducts = await ShopifyStorefront.getAllProducts();
          renderProducts(allProducts.slice(0, 6));
        } else {
          renderProducts(products);
        }
      } catch (error) {
        console.error('Erreur chargement produits:', error);
        grid.innerHTML = `
          <div class="col-span-full text-center py-12 text-gray-500">
            <p>Impossible de charger les produits. Veuillez rafra√Æchir la page.</p>
          </div>
        `;
      }
    }

    function renderProducts(products) {
      const grid = document.getElementById('top-ventes-grid');
      
      if (products.length === 0) {
        grid.innerHTML = `
          <div class="col-span-full text-center py-12 text-gray-500">
            <p>Aucun produit disponible pour le moment.</p>
            <a href="catalogue.html" class="text-blue-600 hover:underline mt-2 inline-block">Voir le catalogue</a>
          </div>
        `;
        return;
      }

      grid.innerHTML = products.map(product => {
        const variant = product.variants.edges[0]?.node;
        const price = variant ? parseFloat(variant.price.amount).toFixed(2) : '0.00';
        const imageUrl = product.images.edges[0]?.node?.url || 'https://upload.wikimedia.org/wikipedia/commons/e/e0/PlaceholderLC.png';
        const variantId = variant?.id || '';
        const available = variant?.availableForSale;
        
        // D√©terminer l'URL de la page produit
        const productPageUrl = `product-${product.handle}.html`;

        return `
          <div class="group bg-white rounded-2xl shadow hover:shadow-lg transition overflow-hidden">
            <a href="${productPageUrl}" class="block">
              <div class="relative">
                <img src="${imageUrl}" alt="${product.title}" class="w-full h-56 object-contain bg-white p-3" loading="lazy">
                <span class="absolute top-3 left-3 bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow">üî• Top Vente</span>
              </div>
              <div class="p-5">
                <div class="flex items-start justify-between gap-3">
                  <h3 class="text-lg font-bold text-gray-900 group-hover:text-blue-600 line-clamp-2">${product.title}</h3>
                  <div class="text-blue-600 font-extrabold whitespace-nowrap">${price}$ CAD</div>
                </div>
                <p class="text-sm text-gray-600 mt-2 line-clamp-2">${product.description || 'D√©couvrez ce produit'}</p>
              </div>
            </a>
            <div class="px-5 pb-5 flex gap-2">
              <button 
                onclick="addToCartFromGrid('${variantId}', '${product.id}', '${product.title.replace(/'/g, "\\'")}', ${price}, '${imageUrl}', '${product.handle}')"
                class="flex-1 bg-blue-600 text-white py-2.5 rounded-xl font-semibold hover:bg-blue-700 transition text-sm ${!available ? 'opacity-50 cursor-not-allowed' : ''}"
                ${!available ? 'disabled' : ''}
              >
                ${available ? 'üõí Ajouter' : 'Indisponible'}
              </button>
              <a href="${productPageUrl}" class="px-4 py-2.5 border border-gray-200 rounded-xl font-semibold text-gray-700 hover:bg-gray-50 transition text-sm">
                Voir ‚Üí
              </a>
            </div>
          </div>
        `;
      }).join('');
    }

    // Ajouter au panier depuis la grille
    function addToCartFromGrid(variantId, productId, title, price, image, handle) {
      if (!variantId) {
        alert('Produit non disponible');
        return;
      }

      NovaCart.addItem({
        variantId,
        productId,
        title,
        price: parseFloat(price),
        quantity: 1,
        image,
        handle
      });

      // Animation de confirmation
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = '‚úì Ajout√©!';
      btn.classList.add('bg-green-600');
      setTimeout(() => {
        btn.textContent = originalText;
        btn.classList.remove('bg-green-600');
      }, 1500);

      // Ouvrir le mini-cart
      document.getElementById('mini-cart').classList.add('active');
      renderMiniCart();
    }

    // Initialisation
    document.addEventListener('DOMContentLoaded', function() {
      loadTopVentes();
      NovaCart.init();
    });
  </script>
</body>
</html>
